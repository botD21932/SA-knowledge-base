**OAuth 2** — это протокол авторизации, предназначенный для организации доступа клиентских приложений к ресурсам, или данным учетных записей, пользователя на другом сервисе. В качестве клиентских приложений выступают веб-сервисы, мобильные и десктопные приложения. В качестве сервисов — mail.ru, GitHub, Bitbucket и др. Протокол используют разработчики сторонних приложений. Часто в роли обёртывающего протокола выступает [[HTTP]].

**Роли в OAuth 2.0:**
1) **Владелец (пользователь).** Авторизует клиентское приложение на доступ к данным своего аккаунта
2) **Сервер ресурсов/API.** Здесь располагаются данные пользовательских аккаунтов, а также бизнес-логика авторизации, отвечающая за выдачу новых OAuth-токенов и проверку их подлинности при обращении клиентских приложений к ресурсам. Целесообразно объединять эти роли, так как физически это один сервис
3) **Клиентское приложение.** Собственно сервис, которому пользователь делегирует права доступа к своим данным на сервере ресурсов. Пользователь должен авторизовать приложение, а со стороны сервера API оно должно получить подтверждение в виде ключа (токена) доступа

**Общая схема работы протокола:** ![[изображ3.png]]
**Шаги алгоритма протокола:**
1) Приложение запрашивает у пользователя разрешение на доступ к серверу ресурсов
2) После получения разрешения приложение сообщает об этом авторизационному серверу, а также предоставляет ему сведения о себе
3) Сервер авторизации проверяет подлинность разрешения и предоставленных сведений о приложении. В случае успешной проверки генерируется токен доступа
4) Далее приложение обращается к серверу ресурсов, предоставляя токен в качестве подтверждения пройденной авторизации
5) Сервер ресурсов проверяет действительность токена и выдает приложению доступ к запрашиваемому ресурсу

**Плюсы OAuth 2.0:**
1) Использование SSL для защиты данных
2) Ограничение прав доступа стороннего приложения к пользовательским ресурсам областями видимости
3) Обилие библиотек для реализации использования протокола во всех языках общего назначения

**Минусы OAuth 2.0:**
1) Различия в подходах к реализации у разных сервисов, порождающие необходимость написания отдельного кода под каждый новый сервис
2) Если реализована интеграция с семейством приложений, работающих в одной экосистеме (например, Google), существует риск для всех интеграций при компрометации учетных данных либо сбое на стороне сервера API
3) OAuth 2.0 является новым и динамично развивающимся протоколом, в связи с чем возможны некоторые логические противоречия в его спецификации
4) Основанная на SSL безопасность протокола может стать проблемой в высоконагруженных проектах

**Шаги алгоритма протокола для приложений с серверной частью:** ![[изобр2.png]]
1) Пользователь перенаправляется на страницу авторизации, где у него запрашиваются разрешения для приложения на работу с данными его аккаунта
2) После предоставления необходимых разрешений пользователь попадает на callback URL — адрес, указанный при регистрации приложения, предназначенный для завершения авторизации. При этом происходит подстановка кода авторизации в GET-параметры адреса
3) Сервер клиентского приложения формирует POST-запрос к серверу авторизации API с кодом авторизации в качестве параметра
4) Сервер авторизации проверяет код и возвращает приложению токен доступа (access token)
5) Используя токен, приложение авторизуется на сервере API и получает доступ к запрашиваемым пользовательским ресурсам

**Шаги алгоритма протокола для полностью клиентских приложений:** ![[изобр1.png]]